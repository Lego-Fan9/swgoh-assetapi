
<!-- this file is generated by make_docs.py -->

<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>SWGoH AssetAPI</title>
    <style>
        body {
            font-family: sans-serif, arial;
            max-width: 800px;
            margin: 2em auto;
            padding: 0 1em;
            line-height: 1.6;
            background: #f9f9f9;
            color: #333;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 1em;
            overflow-x: auto;
            border-radius: 5px;
        }

        code {
            background: #eee;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: Consolas, monospace;
        }

        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        h1,
        h2,
        h3 {
            color: #222;
        }

        a {
            color: #0066cc;
        }
    </style>
</head>

<body><h1 id="swgoh-assetapi">SWGoH AssetAPI</h1>
<p>A FastAPI that can download assets for Star Wars: Galaxy of Heroes</p>
<p>This API should work in direct parody with <a href="https://github.com/swgoh-utils/swgoh-ae2">Asset Extractor 2</a>'s AssetWebApi however I have added some endpoints not present in Asset Extractor 2. This tool also works on ARM64 because it uses UnityPy instead of AssetStudioMod</p>
<h2 id="running-with-docker">Running with Docker</h2>
<p>Start the container with something like this:</p>
<div class="codehilite"><pre><span></span><code>docker pull ghcr.io/lego-fan9/swgoh-assetapi:latest
docker run --name AssetAPI \
    -d \
    --restart always \
    -p 3300:3300 \
    --env COMLINK_URL=http://localhost:3200
    ghcr.io/lego-fan9/swgoh-assetapi:latest
</code></pre></div>

<p>The --env flag is optional, and should point to a comlink instance if used. For more info on that see <a href="#assetversion">AssetVersion</a></p>
<h2 id="running-without-docker">Running without Docker</h2>
<p>This tool uses FastAPI with uvicorn so you can do</p>
<div class="codehilite"><pre><span></span><code>git clone https://github.com/lego-fan9/swgoh-assetapi
cd swgoh-assetapi
pip install -r reqs.txt
python assetapi.py
</code></pre></div>

<p>Note: If running in a VM or other compact OS, you may need to install UnityPy from a wheel, or a c/c++ compiler</p>
<h2 id="enviroment-variables">Enviroment Variables</h2>
<ul>
<li>ACCESS_KEY</li>
<li>Optional access/public key. If a secret key is also set HMAC signing is enabled.</li>
<li>SECRET_KEY</li>
<li>Optional secret key. If a access key is also set HMAC signing is enabled.</li>
<li>COMLINK_URL</li>
<li>Optional comlink url. If provided you may use automatic comlink asset version getter. See <a href="#assetversion">AssetVersion</a> for more details</li>
<li>COMLINK_ACCESS</li>
<li>Optional comlink access key. If comlink secret key is also set, your communication with comlink will use HMAC signing</li>
<li>COMLINK_SECRET</li>
<li>Optional comlink secret key. If comlink access key is also set, your communication with comlink will use HMAC signing</li>
</ul>
<p>See <a href="#hmacsigning">HMACSigning</a> for more on HMAC signing</p>
<h2 id="endpoints">Endpoints</h2>
<p>All endpoints are GET.</p>
<p>These docs are avaliable at <code>/docs</code></p>
<p>Swagger docs are avaliable at <code>/swagger</code></p>
<h3 id="assetlist">/Asset/list</h3>
<p>Returns a list of every asset in the game. </p>
<p><strong>Args:</strong></p>
<ul>
<li>version: int</li>
<li>See <a href="#assetversion">AssetVersion</a></li>
<li>forceReDownload: bool, Default: False</li>
<li>If set to true it will download a new manifest, otherwise it tries to use a locally stored one</li>
<li>assetOS: int, Default: 0</li>
<li>See <a href="#assetos">AssetOS</a></li>
</ul>
<p><strong>Response:</strong></p>
<ul>
<li>Type: JSON list</li>
<li>Format: list[str]</li>
</ul>
<p><strong>Example</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">3300</span><span class="o">/</span><span class="n">Asset</span><span class="o">/</span><span class="n">list</span><span class="err">?</span><span class="n">version</span><span class="o">=</span><span class="mi">36530</span><span class="o">&amp;</span><span class="n">forceReDownload</span><span class="o">=</span><span class="bp">false</span><span class="o">&amp;</span><span class="n">assetOS</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>

<p>Response: </p>
<div class="codehilite"><pre><span></span><code>[
  &quot;ability_000_basic&quot;,
  &quot;ability_000_special01&quot;,
  &quot;ability_50rt_basic&quot;,
  ...
]
</code></pre></div>

<h3 id="assetlistdiff">/Asset/listDiff</h3>
<p>Returns a list of new and/or changed assets</p>
<p><strong>Args:</strong></p>
<ul>
<li>version: int</li>
<li>See <a href="#assetversion">AssetVersion</a></li>
<li>diffVersion: int</li>
<li>This is the older version. If you do not have it, this endpoint is useless</li>
<li>forceReDownload: bool, Default: False</li>
<li>If set to true it will download a new manifest, otherwise it tries to use a locally stored one</li>
<li>diffType: int, Default: 0</li>
<li>A diffType of 1 will return all manifest entries that are new, a diffType of 2 will return any entries that changed, a diffType of 0 returns both</li>
<li>prefix: str, Default: Null</li>
<li>A filter to make it only return entries with this as the prefix. The prefix is everything before the first underscore, for example, charui_b1 has charui as the prefix</li>
<li>assetOS: int, Default: 0</li>
<li>See <a href="#assetos">AssetOS</a></li>
</ul>
<p><strong>Response:</strong></p>
<ul>
<li>Type: JSON list</li>
<li>Format: list[str]</li>
</ul>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">3300</span><span class="o">/</span><span class="n">Asset</span><span class="o">/</span><span class="n">listDiff</span><span class="err">?</span><span class="n">version</span><span class="o">=</span><span class="mi">36528</span><span class="o">&amp;</span><span class="n">diffVersion</span><span class="o">=</span><span class="mi">36530</span><span class="o">&amp;</span><span class="n">forceReDownload</span><span class="o">=</span><span class="bp">false</span><span class="o">&amp;</span><span class="n">diffType</span><span class="o">=</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">assetOS</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>

<p>Response: </p>
<div class="codehilite"><pre><span></span><code>[
  &quot;ability_char_beam_tombguardian_aoe_lb1&quot;,
  &quot;ability_char_blade_jumpstrike_cx2_lb&quot;,
  &quot;ability_char_force_crush_lordvader_aoe_lb2&quot;,
  ...
]
</code></pre></div>

<h3 id="assetsingle">/Asset/single</h3>
<p>Get a single asset in a ready to download object <code>/Asset/many</code> is recommended over this endpoint, however this exists because it matches what <a href="https://github.com/swgoh-utils/swgoh-ae2">Asset Extractor 2</a> outputs. <a href="#assetsinglevsmany">Here's why</a></p>
<p><strong>Args:</strong>
* version: int
  * See <a href="#assetversion">AssetVersion</a>
* assetName: string
  * The name of the asset you want. Get this from <code>/Asset/list</code>
* forceReDownload: bool, Default: False
  * If set to true it will download a new copy of the asset, otherwise it tries to use a locally stored one
* assetOS: int, Default: 0
  * See <a href="#assetos">AssetOS</a></p>
<p><strong>Response:</strong></p>
<ul>
<li>Type: attachment</li>
<li>Format: image/png</li>
</ul>
<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">3300</span><span class="o">/</span><span class="n">Asset</span><span class="o">/</span><span class="n">single</span><span class="err">?</span><span class="n">version</span><span class="o">=</span><span class="mi">36530</span><span class="o">&amp;</span><span class="n">assetName</span><span class="o">=</span><span class="n">charui_b1</span><span class="o">&amp;</span><span class="n">forceReDownload</span><span class="o">=</span><span class="bp">false</span><span class="o">&amp;</span><span class="n">assetOS</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>

<h3 id="assetmany">/Asset/many</h3>
<p>Downloads multiple assets at once. I recommend this endpoint instead of <code>/Asset/single</code> <a href="#assetsinglevsmany">Here's why</a></p>
<p><strong>Args:</strong>
* version: int
  * See <a href="#assetversion">AssetVersion</a>
* assetNames: string
  * The name of the assets you want, seperated by a comma. Get this from <code>/Asset/list</code> 
* forceReDownload: bool, Default: False
  * If set to true it will download a new copy of the asset, otherwise it tries to use a locally stored one
* assetOS: int, Default: 0
  * See <a href="#assetos">AssetOS</a></p>
<p><strong>Response:</strong></p>
<ul>
<li>Type: JSON list</li>
<li>Format: </li>
</ul>
<div class="codehilite"><pre><span></span><code>[
    {
        &quot;assetName&quot;: string,
        &quot;assetData&quot;: [
            {
                &quot;name&quot;: string,
                &quot;img&quot;: string,
                &quot;valid&quot;: bool
            }...
        ]
    }...
]
</code></pre></div>

<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">3300</span><span class="o">/</span><span class="n">Asset</span><span class="o">/</span><span class="n">many</span><span class="err">?</span><span class="n">version</span><span class="o">=</span><span class="mi">36530</span><span class="o">&amp;</span><span class="n">assetNames</span><span class="o">=</span><span class="n">charui_b1</span><span class="o">%</span><span class="mi">2</span><span class="n">Ccharui_b2</span><span class="o">&amp;</span><span class="n">forceReDownload</span><span class="o">=</span><span class="bp">false</span><span class="o">&amp;</span><span class="n">assetOS</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>

<p>Response: </p>
<div class="codehilite"><pre><span></span><code><span class="cp">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;assetName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;charui_b1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;assetData&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tex.charui_b1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;img&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;data:image/png;base64,iVBOR...&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;valid&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="cp">]</span>
<span class="w">  </span><span class="err">}</span><span class="o">,</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="err">&quot;assetName&quot;:</span><span class="w"> </span><span class="err">&quot;charui_b2&quot;,</span>
<span class="w">    </span><span class="err">&quot;assetData&quot;:</span><span class="w"> </span><span class="cp">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tex.charui_b2&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;img&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;data:image/png;base64,iVBOR...&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;valid&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="cp">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="o">]</span>
</code></pre></div>

<ul>
<li>assetName</li>
<li>The name of the asset as it is found in the manifest</li>
<li>assetData.name</li>
<li>The true asset name. This is what the game uses to save the asset to file</li>
<li>assetData.img</li>
<li>The image data as a base64 download link. This can be pasted straight into a browser</li>
<li>assetData.valid</li>
<li>If the asset failed to be decoded this will be false</li>
</ul>
<h2 id="assetversion">AssetVersion</h2>
<p>To get the asset version you need a Comlink instance. For more details on that see <a href="https://GitHub.com/swgoh-utils/swgoh-comlink">Their GitHub Repository</a></p>
<h3 id="using-assetapi">Using AssetAPI</h3>
<p>AssetAPI has the option to include a link to your comlink instance via the COMLINK_URL enviroment variable. If this is specified, you can do version=0 in all of your requests and it will use Comlink</p>
<h3 id="without-assetapi">Without AssetAPI</h3>
<p>If you don't want to use AssetAPI's version getter, You can get it by calling <code>/metadata</code> with comlink, and then it is "assetVersion"</p>
<h2 id="assetos">AssetOS</h2>
<p>The AssetOS is used to determine which quality of object should be returned. The options are:</p>
<ul>
<li>0</li>
<li>This is Windows, and is the highest quality, largest image size</li>
<li>1</li>
<li>This is Android, and is the lowest quality, smallest image size</li>
<li>2</li>
<li>This is iOS, and is the middle between Android and Windows</li>
</ul>
<h2 id="hmacsigning">HMACSigning</h2>
<p>If the ACCESS_KEY and SECRET_KEY are both set, HMAC signing is enabled. To create HMAC requests you can do something like this</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generateAuthHeaders</span><span class="p">(</span><span class="n">secret_key</span><span class="p">,</span> <span class="n">access_key</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
        <span class="n">req_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X-Date&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">}</span>

        <span class="n">hmac_obj</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">secret_key</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span>
        <span class="n">hmac_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">timestamp</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">hmac_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;GET&#39;</span><span class="p">)</span>
        <span class="n">hmac_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

        <span class="n">hmac_digest</span> <span class="o">=</span> <span class="n">hmac_obj</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="n">req_headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;HMAC-SHA256 Credential=</span><span class="si">{</span><span class="n">access_key</span><span class="si">}</span><span class="s1">,Signature=</span><span class="si">{</span><span class="n">hmac_digest</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">req_headers</span>

<span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">endpoint</span><span class="o">+</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">generateAuthHeaders</span><span class="p">(</span><span class="n">SECRET_KEY</span><span class="p">,</span> <span class="n">ACCESS_KEY</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))))</span>
</code></pre></div>

<p>"endpoint" should be something like "/Asset/list"</p>
<h2 id="cleaning-temp-files-up">Cleaning temp files up</h2>
<p>AssetAPI stores a copy of every bundle it downloads, as well as a JSON version of the manifest. It all goes in the <code>tmp/</code> directory. To clean it, you can either delete the <code>tmp/</code> directory, run the <code>/cleanup</code> endpoint, or run the cleanup script. If you delete the <code>tmp/</code> directory or run the cleanup script I suggest restarting the server as well. </p>
<p>To run the cleanup script navigate to the same directory as <code>assetapi.py</code> then run <code>cd helpers</code>. finally run </p>
<div class="codehilite"><pre><span></span><code>python FileCleaner.py
</code></pre></div>

<h2 id="assetsinglevsmany">AssetSingleVsMany</h2>
<ul>
<li><code>/Asset/single</code></li>
<li>Returns a single asset only</li>
<li><code>/Asset/many</code></li>
<li>Returns many assets, but you need to decode a bit</li>
</ul>
<p>Unity bundles can contain many assets in them. You can only return a single asset with the method <code>/Asset/single</code> uses, even if there are many in a bundle, So <code>/Asset/single</code> will return the first image UnityPy finds. <code>/Asset/many</code> is able to return many more. To see this for yourself I suggest looking at the results of both of these.</p>
<div class="codehilite"><pre><span></span><code>http://localhost:3300/Asset/single?version=36530&amp;assetName=shared_resourcecontainer
</code></pre></div>

<div class="codehilite"><pre><span></span><code>http://localhost:3300/Asset/many?version=36530&amp;assetNames=shared_resourcecontainer
</code></pre></div>
</body>

</html>
